<!doctype html>
<html>
<head>
<title>ETHLottery</title>
<meta charset="utf-8">
<script type="text/javascript" src="node_modules/bignumber.js/bignumber.min.js"></script>
<script type="text/javascript" src="node_modules/web3/dist/web3-light.js"></script>
<style>
div {
    font-weight: bold;
}

div span {
    font-weight: normal;
}
</style>
</head>

<body>
    <h1>ETHLottery</h1>
    <div>ADDRESS: <span id="address"></span></div> 
    <div>OPEN: <span id="open"></span></div> 
    <div>TOTAL ACCUMULATED: <span id="total"></span> <span>ETH</span></div> 
    <div>OWNER FEE: <span id="owner-fee"></span> <span>%</span></div> 
    <div>FEE: <span id="fee"></span> <span>ETH</span></div> 
    <div>RESULT: <span id="result"></span></div> 

<script type="text/javascript">

    var Web3 = require('web3');
    var BigNumber = require('bignumber.js');
    
    if (typeof web3 !== 'undefined') {
          var web3 = new Web3(web3.currentProvider);
    } else {
        // set the provider you want from Web3.providers, for local dev
          var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
    }

    var abi = [{"constant":true,"inputs":[],"name":"owner_fee","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getValue","outputs":[{"name":"","type":"uint256"}],"payable":true,"type":"function"},{"constant":false,"inputs":[],"name":"destruct","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"total","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_char","type":"bytes1"}],"name":"lottery","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"result","outputs":[{"name":"","type":"bytes1"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"jackpot","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_char","type":"bytes1"}],"name":"play","outputs":[],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"fee","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"open","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"inputs":[{"name":"_fee","type":"uint256"},{"name":"_jackpot","type":"uint256"},{"name":"_owner_fee","type":"uint256"}],"payable":false,"type":"constructor"}];

    var address = "0x4b8ed55eac499816532a5388373bfff0398c8203";
 
    var ETHLottery = web3.eth.contract(abi).at(address);

    var participant = web3.eth.coinbase;

    document.getElementById('address').innerText = address;

    ETHLottery.open(function (e, c) {
        document.getElementById('open').innerText = c;
    });

    ETHLottery.total(function (e, c) {
        document.getElementById('total').innerText = c / 1000000000000000000;
    });

    ETHLottery.fee(function (e, c) {
        document.getElementById('fee').innerText = c / 1000000000000000000;
    });

    ETHLottery.owner_fee(function (e, c) {
        document.getElementById('owner-fee').innerText = c;
    });

    ETHLottery.result(function (e, c) {
        document.getElementById('result').innerText = c;
    });
    
    function play (guess) {
        if (guess.length == 1) {
            var fee = new BigNumber(document.getElementById('fee').text);
            ETHLottery.play(guess, { from : participant, value: fee }, function (e, c) {
                console.log('played');
            });
        }
    }

    function withdraw () {
        ETHLottery.withdraw({ from : participant }), function (e, c) {
            console.log('withdraw requested');
        };
    }

</script>

</body>

</html>
